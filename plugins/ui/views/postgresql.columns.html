const {formatBytes} = require('../../../common/format.js');
module.exports = (req, res, next, data) => res.send(`
  ${require('./partials/header.html')(req)}
    <appkit-app>
      ${require('./partials/object-header.html')(req, data, 'Columns', 'fa-columns', `/ui/postgresql/columns/${data.column}`, data.column, 'postgresql/columns')}
      <div>
        <h2>${data.human_name}<sub>${data.human_name !== data.name ? `(${data.name})` : ``}</sub></h2>
        ${data.annotations && data.annotations.description ? `
        <p class="description">${data.annotations.description}</p>
        ` : ''}
        <dl class="facts">
          <dt>Scanned</dt>
          <dd>${new Date(data.observed_on).toLocaleString()}</dd>
        </dl>
      </div>
      <x-tabs>
        <x-tab><a href="#metadata">Metadata</a></x-tab>
        <x-tab><a href="#changes">Changes</a></x-tab>
        <x-tab><a href="#used_by">Used By</a></x-tab>
        <x-tab><a href="#uses">Uses</a></x-tab>
        ${data.statistics ? `<x-tab><a href="#statistics">Statistics</a></x-tab>` : ''}
        <x-tab><a href="#definition">Definition</a></x-tab>
      </x-tabs>
      <div name="metadata" class="tab-panel">
        ${require('./partials/metadata.html')(req, data, `/ui/postgresql/columns/${data.column}`)}
      </div>
      <div name="changes" class="tab-panel list">
        ${require('./partials/changes.html')(req, data)}
      </div>
      <div name="used_by" class="tab-panel list"> 
        ${require('./partials/used_by.html')(req, data)}
      </div>
      <div name="uses" class="tab-panel list"> 
        ${require('./partials/uses.html')(req, data)}
      </div>
      ${data.statistics ? `
      <div name="statistics" class="tab-panel list">
        <div class="list-item">
          <div>Distinct Values</div>
          <div class="pre-inline">${data.statistics.n_distinct < 0 ? (data.statistics.n_distinct*-1*100).toFixed(2) + '%' : data.statistics.n_distinct}</div>
        </div>
        <div class="list-item">
          <div>Percent Null</div>
          <div class="pre-inline">${(data.statistics.null_frac * 100).toFixed(2) + '%'}</div>
        </div>
        <div class="list-item">
          <div>Average Size</div>
          <div class="pre-inline">${formatBytes(data.statistics.avg_width)}</div>
        </div>
        ${data.statistics.histogram_bounds ? `
        <div class="list-item">
          <div>Min Value</div>
          <div class="pre-inline">${data.statistics.histogram_bounds[0]}</div>
        </div>
        <div class="list-item">
          <div>Max Value</div>
          <div class="pre-inline">${data.statistics.histogram_bounds[data.statistics.histogram_bounds.length - 1]}</div>
        </div>
        ` : ''}
        ${data.statistics.most_common_vals ? `
        <div class="list-item section">
          Histogram
        </div>
        ${data.statistics.most_common_vals.map((x, i) => `
        <div class="list-item">
          <div class="percentage" style="background-image:linear-gradient(to right, var(--highlight-link-color), var(--highlight-link-color) ${(data.statistics.most_common_freqs[i] * 100).toFixed(2) + '%'}, rgba(0,0,0,0) ${(data.statistics.most_common_freqs[i] * 100).toFixed(2) + '%'});">
            ${x} (${(data.statistics.most_common_freqs[i] * 100).toFixed(2) + '%'})
          </div>
        </div>
        `).join('')}
        ` : ''}
      </div>
      ` : ''}
      <div name="definition" class="tab-panel">
        <pre><code class="hljs json">${JSON.stringify(data, null, 2)}</code></pre>
      </div>
    </appkit-app>
  ${require('./partials/footer.html')(req, res)}
`);