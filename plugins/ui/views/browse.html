function createUrlWithQueryParams(req, key, value) {
  return `?${key}=${value}&${Object.keys(req.query).filter((x) => x !== key).map((x) => `${x}=${req.query[x]}`).join('&')}`
}
module.exports = (req, res, next, data) => res.send(`
  ${require('./partials/header.html')(req)}
    <appkit-app>
      <nav-breadcrumb size="small">
        <ul>
          <li><i class="fa fa-cubes" aria-hidden="true"></i> Home</li>
        </ul>
        <button class="passive sort-filter">Sort <i class="fa fa-sort" aria-hidden="true"></i></button>
        <x-dropdown target=".sort-filter">
          <nav>
            <ul>
              <li><a tabindex="0" href="${createUrlWithQueryParams(req, 'sort', 'name')}">Name</a></li>
              <li><a tabindex="0" href="${createUrlWithQueryParams(req, 'sort', 'type')}">Type</a></li>
              <li><a tabindex="0" href="${createUrlWithQueryParams(req, 'sort', 'observed_on')}">Observed On</a></li>
          </nav>
        </x-dropdown>
      </nav-breadcrumb>
      <div class="table-list">
      ${data.rows.map((row) => `
        <div class="table-list-item">
          <div class="icon">
            <img src="/${row.type.split('/').join('.')}.svg" />
          </div>
          <div>
            <a class="name" href="/ui/${row.type.replace('.', '/')}/${row.node}">
              ${row.labels && row.labels.name ? row.labels.name : (row.name || `<i>unknown</i>`)}
              ${row.labels && row.labels.name ? `<sub>${row.name}</sub>` : ``}
            </a>
            <sub class="last-seen">Last seen ${row.observed_on.toLocaleString()}</sub>
          </div>
          <div class="labels">
            ${row.labels ? Object.keys(row.labels).map((key) => `
            <a class="pill" href="?${data.cursor.template}&labels=${key}">
              <i class="fa fa-tag" aria-hidden="true"></i> 
              <span class="name">${key}</span>
              <span class="value">${row.labels[key]}</span>
            </a>
            `).join("") : ''}
          </div>
        </div>
      `).join('')}
      </div>
      ${require('./partials/pagination.html')(req, data)}
    </appkit-app>
  ${require('./partials/footer.html')(req, res)}
`);