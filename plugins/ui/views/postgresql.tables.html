const {formatBytes} = require('../../../common/format.js');
module.exports = (req, res, next, data) => res.send(`
  ${require('./header.html')(req)}
    <appkit-app>
      ${require('./object-header.html')(req, data, 'Tables', 'fa-table', `/ui/postgresql/tables/${data.table}`, data.table, 'postgresql/tables')}
      <div>
        <h2>${data.human_name}<sub>${data.human_name !== data.name ? `(${data.name})` : ``}</sub></h2>
        <dl class="facts">
          <dt>
            View
          </dt>
          <dd>
            ${data.is_view}
          </dd>
          <dt>Size</dt>
          <dd>
            ${formatBytes(data.tableStatistics.reduce((acc, x) => 
              (parseInt(x.index_size, 10) + parseInt(x.table_size, 10) + acc), 0))}
          </dd>
          <dt>Data Size</dt>
          <dd>
            ${formatBytes(data.tableStatistics.reduce((acc, x) => 
              (parseInt(x.table_size, 10) + acc), 0))}
          </dd>
          <dt>Scanned</dt>
          <dd>${new Date(data.observed_on).toLocaleString()}</dd>
        </dl>
      </div>
      <x-tabs>
        <x-tab><a href="#metadata">Metadata</a></x-tab>
        <x-tab><a href="#changes">Changes</a></x-tab>
        <x-tab><a href="#used_by">Used By</a></x-tab>
        <x-tab><a href="#columns">Columns</a></x-tab>
        <x-tab><a href="#definition">Definition</a></x-tab>
      </x-tabs>
      <div name="metadata" class="tab-panel list">
        ${require('./labels.html')(req, data, `/ui/postgresql/tables/${data.table}`)}
        ${require('./annotations.html')(req, data, `/ui/postgresql/tables/${data.table}`)}
      </div>
      <div name="changes" class="tab-panel list">
        ${require('./changes.html')(req, data)}
      </div>
      <div name="used_by" class="list tab-panel"> 
        ${require('./used_by.html')(req, data)}
      </div>
      <div name="columns" class="list tab-panel">
        ${data.columns.sort((x, y) => x.position > y.position ? 1 : -1 ).map((column) => `
        <div class="list-item">
          <div><a href="/ui/postgresql/columns/${column.column}">${column.name}</a></div>
          <div>
            <dl class="facts">
              <dt>type</dt><dd>${column.data_type}</dd>
              <dt>position</dt><dd>${column.position}</dd>
              <dt>nullable</dt><dd>${column.is_nullable}</dd>
            </dl>
          </div>
        </div>
        `).join("")}
      </div> 
      <div name="definition" class="tab-panel">
        <pre>${data.is_view ? 
          `<code class="hljs sql">${data.tables[0].definition}</code>` : 
          `<code class="hljs json">${JSON.stringify({...data.tables[0], columns:data.columns}, null, 2)}`
        }</pre>
      </div>
    </appkit-app>
  ${require('./footer.html')(req, res)}
`);